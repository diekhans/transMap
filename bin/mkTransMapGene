#!/usr/bin/env python
import sys, os
rootDir = os.path.normpath(os.path.dirname(os.path.dirname(sys.argv[0])))
sys.path.append(rootDir+"/extern/pycbio/lib")
from optparse import OptionParser
from pycbio.tsv.TSVReader import TSVReader
from pycbio.sys import fileOps

class CmdLine(object):
    usage="""%prog [options] meta [met ...]

    convert meta files to the transMapGene table format
assumes dir containing files is srcName
"""
    def __init__(self):
        parser = OptionParser(usage=CmdLine.usage)
        (opts, args) = parser.parse_args()
        if len(args) < 1:
            parser.error("wrong number of arguments")
        self.metas = args
        self.__dict__.update(opts.__dict__)

def parseSrcDb(fpath):
    return fpath.split("/")[-2]

def metaCnv(metaFile, outFh):
    srcDb = parseSrcDb(metaFile)
    for meta in TSVReader(metaFile, columns=("acc","cds","gene","mol")):
        if (meta.cds != "") or (meta.gene != ""):
            fileOps.prRowv(outFh, meta.acc, meta.cds, srcDb, meta.gene)

opts = CmdLine()
for meta in opts.metas:
    metaCnv(meta, sys.stdout)
