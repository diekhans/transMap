#!/usr/bin/env python
import sys, os
rootDir = os.path.normpath(os.path.dirname(os.path.dirname(sys.argv[0])))
sys.path.append(rootDir+"/extern/pycbio/lib")
from optparse import OptionParser
from pycbio.sys import fileOps
from pycbio.hgdata import hgDb

class CmdLine(object):
    usage="""%prog [options] version destDbs

    generate list of tables to push
"""
    def __init__(self):
        parser = OptionParser(usage=CmdLine.usage)
        (opts, args) = parser.parse_args()
        if len(args) < 2:
            parser.error("wrong number of arguments")
        self.version = args[0]
        self.destDbs = args[1:]
        self.__dict__.update(opts.__dict__)


def listTransMapTbls(conn, db, version, fh):
    sql = 'show tables from ' + db + ' like "transMap%' + version + '"'
    cur = conn.cursor()
    try:
        cur.execute(sql)
        for row in cur:
            fh.write(db + "." + row[0] + "\n")
    finally:
        cur.close()

    
opts = CmdLine()
conn = hgDb.connect()
listTransMapTbls(conn, "hgFixed", opts.version, sys.stdout)
for db in opts.destDbs:
    listTransMapTbls(conn, db, opts.version, sys.stdout)
