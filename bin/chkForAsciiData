#!/usr/bin/env tclsh
set usage {
    chkForAsciiData [files]

Check that files appeart to be ASCII data. Use this to check for corruption.
If files is not specified, everything under data ending with .bz2 is checked.
}

proc checkFile {path} {
    if {[string match *.bz2 $path]} {
        set cat bzcat
    } else {
        set cat cat
    }

    set stat [exec $cat $path | file -]
    if {![string match "/dev/stdin: ASCII text*" $stat]} {
        puts stderr "$path\t$stat"
    }
}

if {$argc == 0} {
    set files [split [exec find ../data -name *.bz2] \n]
} else {
    set files $argv
}
foreach path  $files {
    checkFile $path
}
